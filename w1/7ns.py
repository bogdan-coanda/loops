from diagram import *
from uicanvas import *
from chain import *

if __name__ == "__main__":

	diagram = Diagram(7)

	# nsk: 666 3 66 4 666 4 66 4 666 4 66 3 666
	
	a = '12345671234561723456127345612374561234756123457612345167234516273451623745162347516234571623451762345126734512637451263475126345712634517263415762341576324157634215763412576341527634157263417526341725634172653417625431762541376254173625417632541762354716253471652347165324716534271653472165347126534716254371652431765243167524316572431652743165247316524371654237165432716453271643527164325716423571642537164257316425713642571634257164327516432715643271654372164537216435721643752164372516473251467325147632514736251437625143672514362751436257143625174362514732651437265143276514326751432657143265174326514732561437256143275614325761432567143256174325614732516472356147235641723654712365472136547231654723615472365147236541723645172364157326417532641735264173256417326541732645173246517324561732451673245176324517362451732641573624157364215736412573641527364157236417523641725364172356471235647213564723156472351647253164725136472516347251643721564372165437126453712643571264375126437152643712564371265437162547316254713625471632547162354761235476213547623154762351476235417625341765234176532417653421765341276534172635471263547216354726135472631547263514726354172634512764351276453127645132764512376451273645127634512367451236475123645712364521736452137645213674521364752136457213645271364523176452316745231647523164572316452731645237164523617452361475236145723614527361452637145263174526314752631457263145276314526731425637142563174256314725631427563412756342175634271563472156347125634715263471562347156324715634275163427561342576134256713425617342561374256134725613427563142576314256731426573142675314267351426731542673145261374526134752613457261345276134526713452617345261437526143572614352761435267143526174352614735216473521467352147635214736521437652143675214365721436527143652174365214735621437562143576214356721453672415367421536741253674152367415326741352674132567413265741326754132765413275641327546132574613254761325467135246713542671354627135467213546712354671325461735246173542617354621735461273541627354126735412763542176354271635427613542763154276351427635412736542173654271365427316542736154273651427365412735642173564271356427315642735164273561427356412735461723546173254613725461327541632754136275413267451326741536274513627453162745361274536217453627145362741536724513672453167245361724536712453672145637241563742156374125637415263741562374156327451632745613274563127456321746532714653274165327461532746513274653127465321746352174632517463215746321754632174563271456327415637245163724561372456317245637124563721456732145763214573621457326145732164573214657321456723146572314675231467253146723514672315467231456273146527314625731462753146273514627315462731456237145623174562314756231457623145672134562713456217345621374562134756213457621345672143562714356217435621473526145372614532761453267145326174532615473216547321564732154673215476321547362154376215436721543627154362175436215743621547326154372615432761543267154326175432615743261534726153427615342671534261753426157342615374265134726513427651342675134265713426517342651374265317426537142653741265374216537426153247615324671532461753246157324615237465123476512346751234657124365172436512743651247365124376512436751243657124635172463512746351247635124673512463751426375146237514632751463725146375214637512463571426357146235714632571463527146357214635712465372146537241653724615372465137246531724653712465731245673124576312457361245731624573126475312467531247653142765314726531476253147652314765321475632147536214753261475321647532146753214765312475631247536124753162475312647351264731526473125647312654731264573124657132456713245761324571632457136245713264751324675132476513247561324751632475136247513264715362471536427513642753164275361425736142537614235761423756412375461237541623754126375412367541237654123756421375462137542613754216375421367542137654213756423175462317542631754236175423167542317654231756423715642375164237561423765142376154237614523761425367142356714236571423675142367154236714523671425361742536147253614275364127536421753642715364721536471253647152364715326471352647132564713265471326457132465712346517234651273465123746521347652134675213465721346527134652173465213746523174652371465237416523746152347615234671523461752346157234615273461524376152436715243617524361572436152743615247361524637154263715462371546327154637215463712546317254631275436125743612547361254376125436712543617254361275431627543126745312674351267431526743125674312657431267543127654312756431275463125746312547631254673125463715246317524631572463152746315247631524673152461375246135724613527461352476135241673524163752416357241635274163524716352417635241367524136572413652741365247136524173652413765241356724135627413562471356243175624137562417356241753624175632417562341756243157642315746231574263157423615742316574231567423157643217564321765432176453217643521764325176423517462351742635174236517423561742351674253167425136742516374251673421567341256734152673415627341567234156732415673421657341265734162574316257413625741632574162357412635741236574123567412357641325764135276413572641375264137256413726541372645137264153762451376245317624537162453761245376214537624153764215376412537641523764153276415372641357624135764213574621357426135742163574213657421356742135764123574612357416253746125347612534671253461725346127534612573461253746215347621534672153462715346217534621573462153746251347625134672513462751346257134625173462513746253174625371462537416257341652734165723416573241657342167534126753416275341672543167254136725416372541673254167235416725341675234167532416753421673542167345216374521634752163457216345271634521763452167342516743215674321657432167543216745321674352167432516742351764253176425137642517364251763425176432157643125764315276431572643175264317256431726543172645317264351726431576243156724315627431562473156243715624351762435167243516274351624735162437516243571624356172435612743561247356124375612435761243567124356'
	
	
	a = ''.join([str(int(x)-1) for x in a])	

	# ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- #
		
	# ex = '0123456 10 234561 20 345612 30 456123 40 561234 50 612345 60 123456'
	
	ex = []
	
	while True:
		found = False
		
		for i in range(0, len(a) - 6 - 49):
			x = a[i:i+7]
			b = ''.join([x[1], x[0], x[2], x[3], x[4], x[5], x[6], x[1], x[2], x[0], x[3], x[4], x[5], x[6], x[1], x[2], x[3], x[0], x[4], x[5], x[6], x[1], x[2], x[3], x[4], x[0], x[5], x[6], x[1], x[2], x[3], x[4], x[5], x[0], x[6], x[1], x[2], x[3], x[4], x[5], x[6], x[0]])
		
			if a[i+7:i+49] == b:
				node = diagram.nodeByPerm[x]
				print(f'[ex:{len(ex)}] found extension {node} @ {i}')
				ex.append(node)
				a = a[:i+7]+a[i+48:]
				found = True
				break
				
		if not found:
			break
	
	# ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- #
		
	currNode = diagram.nodeByPerm[a[0:7]]
	linkType = 1
	for i in range(1, len(a)-6):
		nextPerm = a[i:i+7]
		if len(set(nextPerm)) == 7:
			nextNode = diagram.nodeByPerm[nextPerm]
			assert nextNode.nextLink == None
			assert currNode.links[linkType].next == nextNode
			if linkType == 3:
				diagram.pointers += [currNode]
			currNode.nextLink = nextNode.prevLink = currNode.links[linkType]
			currNode = nextNode
			linkType = 1
		else:
			linkType += 1
	
	diagram.pointers = ex						
	show(diagram)
